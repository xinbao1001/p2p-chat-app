<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>P2P聊天修复版</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <style>
        /* 样式部分保持不变 */
    </style>
</head>
<body>
    <h1>P2P聊天修复版</h1>
    <div id="connection-panel">
        <div class="status">
            你的ID: <span id="my-id">正在连接...</span>
            <button class="copy-btn" id="copy-id-btn">复制</button>
        </div>
        <div id="connection-status" class="status">未连接</div>
        <div>
            <input type="text" id="remote-id" placeholder="输入对方的ID">
            <button id="connect-button">连接</button>
        </div>
    </div>
    <div id="chat-container"></div>
    <div>
        <input type="text" id="message-input" placeholder="输入消息..." disabled>
        <button id="send-button" disabled>发送</button>
    </div>

    <script>
        // 使用备选 PeerJS 服务器
        const peer = new Peer({
            host: 'peerjs-server.herokuapp.com',
            port: 443,
            path: '/',
            debug: 3
        });

        // 其余代码保持不变...
        // 完整代码参考之前的方案
    </script>
</body>
</html>